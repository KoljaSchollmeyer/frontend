name: Frontend CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# WICHTIG: Erlaubt dem Bot, die Testergebnisse an den Commit zu heften
permissions:
  contents: read
  checks: write
  pull-requests: write

jobs:
  build:
    runs-on: ubuntu-latest
    
    # Setzt das Arbeitsverzeichnis auf den frontend-Ordner, 
    # falls dein Repo die Struktur 'root/frontend' hat.
    # Wenn deine package.json direkt im Root liegt, kannst du diese Zeile löschen.
    # defaults:
    #   run:
    #     working-directory: ./frontend 

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          # cache-dependency-path: frontend/package-lock.json # Falls im Unterordner

      - name: Install
        run: npm ci

      - name: Test
        # Wir hängen Flags an, damit Vitest einen XML-Report erstellt
        # "--" leitet die Argumente an das Skript weiter
        run: npm test -- --reporter=junit --outputFile=test-report.xml

      - name: Publish Test Report
        uses: dorny/test-reporter@v1
        if: success() || failure() # Läuft auch, wenn Tests fehlschlagen
        with:
          name: Vue.js Tests           # Der Name, der in GitHub erscheint
          path: 'test-report.xml'      # Pfad zur oben erstellten Datei
          reporter: java-junit         # Vitest nutzt das Standard JUnit-Format

      - name: Build
        run: npm run build